/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds
 */

plugins {
	id 'com.bmuschko.docker-remote-api' version '4.10.0'
}

ext {
	hadoopTarballUrl = 'https://www-us.apache.org/dist/hadoop/common/hadoop-3.2.0/hadoop-3.2.0.tar.gz'
	hadoopDockerImageBuildContext = './build/hadoop/'
	hadoopDockerImageTag = 'hdfs/ha/base'
}

repositories {
    ivy {
        url 'https://www-us.apache.org/dist'
        patternLayout {
	        artifact '[module]/[organization]/[module]-[revision]/[module]-[revision].[ext]' 
        }
        
    }
    
    mavenCentral()
}

configurations {
    hadoopTarBall
}

dependencies {
	hadoopTarBall 'common:hadoop:3.2.0@tar.gz'
}

task prepareHadoopTarball (type: Copy) { 
	println 'The URL to download the Hadoop:' + project.ext.hadoopTarballUrl

	from configurations.hadoopTarBall
	into project.ext.hadoopDockerImageBuildContext
}

task prepareDockerFile(type: Copy) {
	from 'Dockerfile'
	into project.ext.hadoopDockerImageBuildContext
}

import com.bmuschko.gradle.docker.tasks.image.*

task buildHadoopImage(type: DockerBuildImage, dependsOn: [ prepareHadoopTarball, prepareDockerFile ]) {
	inputDir = file(project.ext.hadoopDockerImageBuildContext)
	tags.add(project.ext.hadoopDockerImageTag)
}

